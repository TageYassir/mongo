{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Saas_MongoDB/mongo/app/uis/chat/%5Bid%5D/ChatClient.js"],"sourcesContent":["'use client'\r\n\r\nimport React, { useEffect, useState, useRef } from \"react\"\r\nimport Link from \"next/link\"\r\nimport { useSearchParams, useParams } from \"next/navigation\"\r\nimport { Box, Typography, Container, TextField, Button, List, ListItem, IconButton } from \"@mui/material\"\r\nimport ImageIcon from \"@mui/icons-material/Image\"\r\nimport MicIcon from \"@mui/icons-material/Mic\"\r\nimport StopIcon from \"@mui/icons-material/Stop\"\r\n\r\n/**\r\n * ChatClient with:\r\n * - composer fixed at bottom\r\n * - image upload\r\n * - voice recording (MediaRecorder)\r\n * - messages render attachments (image/audio)\r\n *\r\n * Note: requires server upload endpoint at /api/messages/upload (multipart/form-data).\r\n */\r\n\r\nexport default function ChatClient({ receiver: receiverFromServer = null, receiverId: receiverProp = null }) {\r\n  const searchParams = useSearchParams()\r\n  const receiverFromQuery = searchParams ? searchParams.get(\"receiver\") : null\r\n  const params = useParams ? useParams() : {}\r\n  const routeId = params?.id ?? null\r\n  const receiverId = receiverFromServer ? (receiverFromServer._id || receiverFromServer.id || null) : (receiverProp || receiverFromQuery || routeId || null)\r\n\r\n  const [currentUserId, setCurrentUserId] = useState(null)\r\n  const [currentUser, setCurrentUser] = useState(null)\r\n  const [receiver, setReceiver] = useState(receiverFromServer || null)\r\n  const [messages, setMessages] = useState([])\r\n  const [text, setText] = useState(\"\")\r\n  const [sending, setSending] = useState(false)\r\n  const [error, setError] = useState(null)\r\n  const [loadingMessages, setLoadingMessages] = useState(false)\r\n\r\n  // recording state\r\n  const [recording, setRecording] = useState(false)\r\n  const mediaRecorderRef = useRef(null)\r\n  const recordedChunksRef = useRef([])\r\n\r\n  const messagesEndRef = useRef(null)\r\n  const fileInputRef = useRef(null)\r\n\r\n  useEffect(() => {\r\n    async function loadCurrentUser() {\r\n      try {\r\n        const res = await fetch(\"/api/users?operation=get-current\")\r\n        if (res.ok) {\r\n          const payload = await res.json()\r\n          const uid = payload?.user?._id || payload?.user?.id || payload?.current?.id || payload?.id || null\r\n          if (uid) {\r\n            setCurrentUserId(uid)\r\n            try {\r\n              const r2 = await fetch(`/api/users/${encodeURIComponent(uid)}`)\r\n              if (r2.ok) {\r\n                const p2 = await r2.json()\r\n                const usr = p2?.user ?? p2\r\n                setCurrentUser(usr || null)\r\n                return\r\n              }\r\n            } catch (e) { /* ignore */ }\r\n            setCurrentUser(payload?.user || null)\r\n            return\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // fallback to localStorage\r\n      }\r\n      try {\r\n        const raw = typeof window !== 'undefined' ? localStorage.getItem('user') : null\r\n        if (raw) {\r\n          const parsed = JSON.parse(raw)\r\n          if (parsed?.id) {\r\n            setCurrentUserId(parsed.id)\r\n            setCurrentUser(parsed)\r\n          }\r\n        }\r\n      } catch (e) {}\r\n    }\r\n    loadCurrentUser()\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    async function fetchConversation() {\r\n      if (!receiverId) return\r\n      let userA = currentUserId\r\n      if (!userA) {\r\n        try {\r\n          const raw = typeof window !== 'undefined' ? localStorage.getItem(\"user\") : null\r\n          if (raw) {\r\n            const parsed = JSON.parse(raw)\r\n            if (parsed?.id) userA = parsed.id\r\n          }\r\n        } catch (e) {}\r\n      }\r\n      if (!userA) return\r\n\r\n      setLoadingMessages(true)\r\n      setError(null)\r\n      try {\r\n        const url = `/api/messages?operation=get-conversation&userA=${encodeURIComponent(userA)}&userB=${encodeURIComponent(receiverId)}`\r\n        const res = await fetch(url)\r\n        if (!res.ok) {\r\n          const payload = await res.json().catch(() => null)\r\n          setError(payload?.error || `Server returned ${res.status}`)\r\n          setMessages([])\r\n        } else {\r\n          const payload = await res.json()\r\n          const msgs = Array.isArray(payload?.messages) ? payload.messages : []\r\n          setMessages(msgs)\r\n          setTimeout(() => scrollToBottom(), 50)\r\n        }\r\n      } catch (err) {\r\n        setError(err.message || \"Failed to load conversation\")\r\n      } finally {\r\n        setLoadingMessages(false)\r\n      }\r\n    }\r\n    fetchConversation()\r\n    // refetch when receiver or user changes\r\n  }, [currentUserId, receiverId])\r\n\r\n  const scrollToBottom = () => {\r\n    try {\r\n      if (messagesEndRef.current) {\r\n        messagesEndRef.current.scrollIntoView({ behavior: \"smooth\", block: \"end\" })\r\n      }\r\n    } catch (e) {}\r\n  }\r\n\r\n  // upload helper: sends file via FormData to /api/messages/upload and returns { url, filename, size, type }\r\n  async function uploadFile(file) {\r\n    try {\r\n      const fd = new FormData()\r\n      fd.append(\"file\", file)\r\n      const res = await fetch(\"/api/messages/upload\", { method: \"POST\", body: fd })\r\n      if (!res.ok) {\r\n        const body = await res.json().catch(() => null)\r\n        throw new Error(body?.error || `Upload failed (${res.status})`)\r\n      }\r\n      const payload = await res.json()\r\n      return payload?.file || null\r\n    } catch (err) {\r\n      console.error(\"uploadFile\", err)\r\n      throw err\r\n    }\r\n  }\r\n\r\n  async function handleSend() {\r\n    if ((!text || text.trim() === \"\") && messages.length && !sending) {\r\n      // do nothing if empty message\r\n    }\r\n    if (!receiverId) { setError(\"No receiver selected.\"); return }\r\n    setSending(true)\r\n    setError(null)\r\n\r\n    const sentAt = new Date().toISOString()\r\n    let senderIdFinal = currentUserId\r\n    if (!senderIdFinal) {\r\n      try {\r\n        const raw = typeof window !== 'undefined' ? localStorage.getItem(\"user\") : null\r\n        if (raw) {\r\n          const parsed = JSON.parse(raw)\r\n          senderIdFinal = parsed?.id || null\r\n        }\r\n      } catch (e) {}\r\n    }\r\n    if (!senderIdFinal) {\r\n      setError(\"Unable to determine current user id. Please login again.\")\r\n      setSending(false)\r\n      return\r\n    }\r\n\r\n    const messagePayload = {\r\n      senderId: senderIdFinal,\r\n      receiverId,\r\n      text: text.trim() || \"\",\r\n      sentAt,\r\n      attachments: [], // attachments added by other flows\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(\"/api/messages\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(messagePayload),\r\n      })\r\n      if (res.ok) {\r\n        const payload = await res.json()\r\n        const saved = payload?.message || messagePayload\r\n        setMessages((m) => [...m, saved])\r\n        setText(\"\")\r\n        setTimeout(() => scrollToBottom(), 50)\r\n        // Optionally refetch conversation to ensure persisted ordering\r\n      } else {\r\n        const payload = await res.json().catch(() => null)\r\n        setError(payload?.error || `Server returned ${res.status}`)\r\n      }\r\n    } catch (err) {\r\n      console.error(\"send message error\", err)\r\n      setError(\"Failed to send message\")\r\n    } finally {\r\n      setSending(false)\r\n    }\r\n  }\r\n\r\n  // handle image file selection\r\n  async function handleImageSelected(file) {\r\n    if (!file) return\r\n    try {\r\n      const uploaded = await uploadFile(file)\r\n      if (!uploaded?.url) throw new Error(\"Upload did not return url\")\r\n      // now send a message with attachment\r\n      const senderIdFinal = currentUserId || (JSON.parse(localStorage.getItem(\"user\") || \"{}\").id)\r\n      const payload = {\r\n        senderId: senderIdFinal,\r\n        receiverId,\r\n        text: \"\", // optional caption could be included\r\n        sentAt: new Date().toISOString(),\r\n        attachments: [{ type: \"image\", url: uploaded.url, filename: uploaded.filename, size: uploaded.size }],\r\n      }\r\n      const r = await fetch(\"/api/messages\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(payload),\r\n      })\r\n      if (r.ok) {\r\n        const p = await r.json()\r\n        setMessages((m) => [...m, p?.message || payload])\r\n        setTimeout(() => scrollToBottom(), 50)\r\n      } else {\r\n        const p = await r.json().catch(() => null)\r\n        setError(p?.error || `Server returned ${r.status}`)\r\n      }\r\n    } catch (err) {\r\n      console.error(\"image send error\", err)\r\n      setError(err.message || \"Image upload failed\")\r\n    }\r\n  }\r\n\r\n  // Recording voice message\r\n  async function startRecording() {\r\n    setError(null)\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true })\r\n      const mediaRecorder = new MediaRecorder(stream)\r\n      recordedChunksRef.current = []\r\n      mediaRecorder.addEventListener(\"dataavailable\", (ev) => {\r\n        if (ev.data && ev.data.size > 0) recordedChunksRef.current.push(ev.data)\r\n      })\r\n      mediaRecorder.addEventListener(\"stop\", async () => {\r\n        try {\r\n          const blob = new Blob(recordedChunksRef.current, { type: \"audio/webm\" })\r\n          const file = new File([blob], `voice-${Date.now()}.webm`, { type: blob.type })\r\n          await handleImageSelected(file) // reuse upload/send logic (name is generic)\r\n        } catch (err) {\r\n          console.error(\"record stop error\", err)\r\n        } finally {\r\n          setRecording(false)\r\n          try { stream.getTracks().forEach(t => t.stop()) } catch (e) {}\r\n        }\r\n      })\r\n      mediaRecorderRef.current = mediaRecorder\r\n      mediaRecorder.start()\r\n      setRecording(true)\r\n    } catch (err) {\r\n      console.error(\"startRecording error\", err)\r\n      setError(\"Could not start audio recording (permission denied or unsupported).\")\r\n      setRecording(false)\r\n    }\r\n  }\r\n\r\n  function stopRecording() {\r\n    try {\r\n      if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\r\n        mediaRecorderRef.current.stop()\r\n      }\r\n    } catch (e) {}\r\n  }\r\n\r\n  // file input change handler\r\n  function onFileInputChange(e) {\r\n    const f = e.target.files && e.target.files[0]\r\n    if (f) handleImageSelected(f)\r\n    e.target.value = null\r\n  }\r\n\r\n  return (\r\n    <Container maxWidth=\"md\" sx={{ display: \"flex\", flexDirection: \"column\", height: \"80vh\", p: 0 }}>\r\n      <Box sx={{ p: 2, borderBottom: \"1px solid #eee\" }}>\r\n        <Typography variant=\"h6\">Chat</Typography>\r\n        <Typography variant=\"body2\" color=\"text.secondary\">{receiver ? (receiver.pseudo || receiver.firstName) : \"Select a user\"}</Typography>\r\n      </Box>\r\n\r\n      {/* Messages area - grows and scrolls */}\r\n      <Box sx={{ flex: 1, overflowY: \"auto\", p: 2, bgcolor: \"#fafafa\" }}>\r\n        <List>\r\n          {messages.map((m, idx) => {\r\n            const isMe = String(m.senderId) === String(currentUserId)\r\n            return (\r\n              <ListItem key={m._id || m.id || idx} sx={{ display: \"flex\", flexDirection: \"column\", alignItems: isMe ? \"flex-end\" : \"flex-start\" }}>\r\n                <Box sx={{ bgcolor: isMe ? \"#d1ffd6\" : \"#fff\", p: 1, borderRadius: 1, maxWidth: \"80%\" }}>\r\n                  {m.text ? <Typography variant=\"body1\">{m.text}</Typography> : null}\r\n                  {/* render attachments */}\r\n                  {Array.isArray(m.attachments) && m.attachments.map((a, i) => {\r\n                    if (a.type === \"image\") {\r\n                      return <Box key={i} sx={{ mt: 1 }}><img src={a.url} alt={a.filename || \"image\"} style={{ maxWidth: \"240px\", borderRadius: 6 }} /></Box>\r\n                    }\r\n                    if (a.type === \"audio\") {\r\n                      return <Box key={i} sx={{ mt: 1 }}><audio controls src={a.url} /></Box>\r\n                    }\r\n                    // fallback: show link\r\n                    return <Box key={i} sx={{ mt: 1 }}><a href={a.url} target=\"_blank\" rel=\"noreferrer\">{a.filename || a.url}</a></Box>\r\n                  })}\r\n                  <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: \"block\", mt: 0.5 }}>\r\n                    {m.sentAt ? new Date(m.sentAt).toLocaleString() : \"\"}\r\n                  </Typography>\r\n                </Box>\r\n              </ListItem>\r\n            )\r\n          })}\r\n        </List>\r\n        <div ref={messagesEndRef} />\r\n      </Box>\r\n\r\n      {/* Composer fixed to bottom */}\r\n      <Box sx={{ borderTop: \"1px solid #eee\", p: 1, display: \"flex\", gap: 1, alignItems: \"center\" }}>\r\n        <input type=\"file\" accept=\"image/*,audio/*\" ref={fileInputRef} style={{ display: \"none\" }} onChange={onFileInputChange} />\r\n        <IconButton onClick={() => fileInputRef.current && fileInputRef.current.click()} title=\"Attach photo or audio\">\r\n          <ImageIcon />\r\n        </IconButton>\r\n\r\n        <IconButton onClick={() => { recording ? stopRecording() : startRecording() }} color={recording ? \"error\" : \"default\"} title={recording ? \"Stop recording\" : \"Record voice\"}>\r\n          {recording ? <StopIcon /> : <MicIcon />}\r\n        </IconButton>\r\n\r\n        <TextField\r\n          placeholder=\"Type a message...\"\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          fullWidth\r\n          size=\"small\"\r\n          onKeyDown={(e) => { if (e.key === \"Enter\" && !e.shiftKey) { e.preventDefault(); handleSend() } }}\r\n        />\r\n\r\n        <Button variant=\"contained\" onClick={handleSend} disabled={sending}>\r\n          Send\r\n        </Button>\r\n      </Box>\r\n    </Container>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}