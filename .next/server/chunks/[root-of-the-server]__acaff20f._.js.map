{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///D:/Saas_MongoDB/mongo/app/api/messages/upload/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport fs from \"fs\"\r\nimport path from \"path\"\r\n\r\nconst CORS_HEADERS = {\r\n  \"Access-Control-Allow-Origin\": \"*\",\r\n  \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\r\n  \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\r\n}\r\n\r\nexport async function OPTIONS(request) {\r\n  return new NextResponse(null, { status: 204, headers: CORS_HEADERS })\r\n}\r\n\r\nfunction ensureUploadsDir() {\r\n  const uploadsDir = path.join(process.cwd(), \"public\", \"uploads\")\r\n  if (!fs.existsSync(uploadsDir)) {\r\n    fs.mkdirSync(uploadsDir, { recursive: true })\r\n  }\r\n  return uploadsDir\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    const formData = await request.formData()\r\n    let file = formData.get(\"file\")\r\n\r\n    // fallback: pick first file-like entry if field name differs\r\n    if (!file) {\r\n      for (const entry of formData.values()) {\r\n        if (entry && typeof entry === \"object\" && (typeof entry.stream === \"function\" || typeof entry.arrayBuffer === \"function\")) {\r\n          file = entry\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!file || typeof file.arrayBuffer !== \"function\") {\r\n      return NextResponse.json({ error: \"No file uploaded or unsupported file object\" }, { status: 400, headers: CORS_HEADERS })\r\n    }\r\n\r\n    const origName = file.name || `upload-${Date.now()}`\r\n    const ext = path.extname(origName)\r\n    const base = path.basename(origName, ext).replace(/[^a-z0-9_\\-]/gi, \"_\")\r\n    const filename = `${Date.now()}-${base}${ext || \"\"}`\r\n    const uploadsDir = ensureUploadsDir()\r\n    const destPath = path.join(uploadsDir, filename)\r\n\r\n    // Read the web File/Blob as ArrayBuffer and write to disk\r\n    const arrayBuffer = await file.arrayBuffer()\r\n    const buffer = Buffer.from(arrayBuffer)\r\n    await fs.promises.writeFile(destPath, buffer)\r\n\r\n    const stat = await fs.promises.stat(destPath)\r\n    const size = stat.size\r\n    const mimeType = file.type || null\r\n    const url = `/uploads/${filename}`\r\n\r\n    const fileMeta = { url, filename, size: Number(size || 0), mimeType }\r\n\r\n    return NextResponse.json({ file: fileMeta }, { status: 200, headers: CORS_HEADERS })\r\n  } catch (err) {\r\n    console.error(\"POST /api/messages/upload error:\", err)\r\n    return NextResponse.json({ error: err.message || String(err) }, { status: 500, headers: CORS_HEADERS })\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,eAAe;IACnB,+BAA+B;IAC/B,gCAAgC;IAChC,gCAAgC;AAClC;AAEO,eAAe,QAAQ,OAAO;IACnC,OAAO,IAAI,gJAAY,CAAC,MAAM;QAAE,QAAQ;QAAK,SAAS;IAAa;AACrE;AAEA,SAAS;IACP,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;IACtD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa;QAC9B,wGAAE,CAAC,SAAS,CAAC,YAAY;YAAE,WAAW;QAAK;IAC7C;IACA,OAAO;AACT;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,IAAI,OAAO,SAAS,GAAG,CAAC;QAExB,6DAA6D;QAC7D,IAAI,CAAC,MAAM;YACT,KAAK,MAAM,SAAS,SAAS,MAAM,GAAI;gBACrC,IAAI,SAAS,OAAO,UAAU,YAAY,CAAC,OAAO,MAAM,MAAM,KAAK,cAAc,OAAO,MAAM,WAAW,KAAK,UAAU,GAAG;oBACzH,OAAO;oBACP;gBACF;YACF;QACF;QAEA,IAAI,CAAC,QAAQ,OAAO,KAAK,WAAW,KAAK,YAAY;YACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8C,GAAG;gBAAE,QAAQ;gBAAK,SAAS;YAAa;QAC1H;QAEA,MAAM,WAAW,KAAK,IAAI,IAAI,CAAC,OAAO,EAAE,KAAK,GAAG,IAAI;QACpD,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC;QACzB,MAAM,OAAO,4GAAI,CAAC,QAAQ,CAAC,UAAU,KAAK,OAAO,CAAC,kBAAkB;QACpE,MAAM,WAAW,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,OAAO,OAAO,IAAI;QACpD,MAAM,aAAa;QACnB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;QAEvC,0DAA0D;QAC1D,MAAM,cAAc,MAAM,KAAK,WAAW;QAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,wGAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU;QAEtC,MAAM,OAAO,MAAM,wGAAE,CAAC,QAAQ,CAAC,IAAI,CAAC;QACpC,MAAM,OAAO,KAAK,IAAI;QACtB,MAAM,WAAW,KAAK,IAAI,IAAI;QAC9B,MAAM,MAAM,CAAC,SAAS,EAAE,UAAU;QAElC,MAAM,WAAW;YAAE;YAAK;YAAU,MAAM,OAAO,QAAQ;YAAI;QAAS;QAEpE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAS,GAAG;YAAE,QAAQ;YAAK,SAAS;QAAa;IACpF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO,IAAI,OAAO;QAAK,GAAG;YAAE,QAAQ;YAAK,SAAS;QAAa;IACvG;AACF","debugId":null}}]
}