{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///D:/Saas_MongoDB/mongo/app/admin/%5Bid%5D/page.js"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useEffect, useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport {\r\n  Box,\r\n  Paper,\r\n  Stack,\r\n  Typography,\r\n  TextField,\r\n  Button,\r\n  CircularProgress,\r\n  Divider,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n} from \"@mui/material\"\r\n\r\n/**\r\n * Admin UI for a single user.\r\n *\r\n * - Loads the user by id.\r\n * - Allows editing common fields (firstName, lastName, email, gender, country).\r\n * - Allows saving (PUT) and deleting (DELETE).\r\n * - Tries two common API shapes:\r\n *    1) REST style: GET/PUT/DELETE /api/users/:id\r\n *    2) Query style (fallback): /api/users?operation=get-user&id=...\r\n *\r\n * If your backend exposes different endpoints, adapt the fetch/update/delete helpers below.\r\n */\r\n\r\nexport default function AdminClient({ id }) {\r\n  const router = useRouter()\r\n  const [user, setUser] = useState(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [saving, setSaving] = useState(false)\r\n  const [deleting, setDeleting] = useState(false)\r\n  const [error, setError] = useState(\"\")\r\n  const [confirmOpen, setConfirmOpen] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (!id) return\r\n    fetchUser()\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [id])\r\n\r\n  async function fetchUser() {\r\n    setLoading(true)\r\n    setError(\"\")\r\n    try {\r\n      // try REST-style first\r\n      let res = await fetch(`/api/users/${encodeURIComponent(id)}`)\r\n      if (!res.ok) {\r\n        // fallback: try query-style endpoint\r\n        res = await fetch(`/api/users?operation=get-user&id=${encodeURIComponent(id)}`)\r\n      }\r\n\r\n      if (!res.ok) {\r\n        throw new Error(`Failed to load user: ${res.status} ${res.statusText}`)\r\n      }\r\n\r\n      const payload = await res.json()\r\n      // Support either { user: { ... } } or direct object\r\n      const u = payload?.user ?? payload\r\n      setUser(u)\r\n    } catch (err) {\r\n      console.error(err)\r\n      setError(err?.message || \"Failed to load user\")\r\n      setUser(null)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  function handleChange(e) {\r\n    const { name, value } = e.target\r\n    setUser((prev) => ({ ...prev, [name]: value }))\r\n  }\r\n\r\n  async function handleSave(e) {\r\n    e.preventDefault()\r\n    if (!user) return\r\n    setSaving(true)\r\n    setError(\"\")\r\n    try {\r\n      // Try REST-style update\r\n      let res = await fetch(`/api/users/${encodeURIComponent(id)}`, {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(user),\r\n      })\r\n\r\n      if (!res.ok) {\r\n        // fallback: query-style update\r\n        res = await fetch(`/api/users?operation=update&id=${encodeURIComponent(id)}`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(user),\r\n        })\r\n      }\r\n\r\n      if (!res.ok) {\r\n        const payload = await res.json().catch(() => ({}))\r\n        throw new Error(payload?.error || `Save failed: ${res.status} ${res.statusText}`)\r\n      }\r\n\r\n      const updated = await res.json().catch(() => null)\r\n      // update local state using returned user if provided\r\n      if (updated?.user) {\r\n        setUser(updated.user)\r\n      }\r\n      // minimal success feedback\r\n      alert(\"Saved successfully\")\r\n      // Optionally stay on page for further edits\r\n    } catch (err) {\r\n      console.error(err)\r\n      setError(err?.message || \"Save failed\")\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  async function handleDelete() {\r\n    if (!user) return\r\n    setDeleting(true)\r\n    setError(\"\")\r\n    try {\r\n      // Try REST-style delete\r\n      let res = await fetch(`/api/users/${encodeURIComponent(id)}`, {\r\n        method: \"DELETE\",\r\n      })\r\n\r\n      if (!res.ok) {\r\n        // fallback: query-style delete\r\n        res = await fetch(`/api/users?operation=delete&id=${encodeURIComponent(id)}`, {\r\n          method: \"POST\",\r\n        })\r\n      }\r\n\r\n      if (!res.ok) {\r\n        const payload = await res.json().catch(() => ({}))\r\n        throw new Error(payload?.error || `Delete failed: ${res.status} ${res.statusText}`)\r\n      }\r\n\r\n      alert(\"User deleted\")\r\n      // Go back to users table (adjust path if your table route differs)\r\n      router.push(\"/table\")\r\n    } catch (err) {\r\n      console.error(err)\r\n      setError(err?.message || \"Delete failed\")\r\n    } finally {\r\n      setDeleting(false)\r\n      setConfirmOpen(false)\r\n    }\r\n  }\r\n\r\n  function openConfirm() {\r\n    setConfirmOpen(true)\r\n  }\r\n\r\n  function closeConfirm() {\r\n    setConfirmOpen(false)\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <Box sx={{ p: 4 }}>\r\n        <CircularProgress />\r\n        <Typography sx={{ mt: 2 }}>Loading user…</Typography>\r\n      </Box>\r\n    )\r\n  }\r\n\r\n  if (!user) {\r\n    return (\r\n      <Box sx={{ p: 4 }}>\r\n        <Typography color=\"error\">No user data available. {error ? `Error: ${error}` : \"\"}</Typography>\r\n        <Button sx={{ mt: 2 }} variant=\"outlined\" onClick={() => router.push(\"/table\")}>\r\n          Back to users\r\n        </Button>\r\n      </Box>\r\n    )\r\n  }\r\n\r\n  // pick common fields with fallbacks\r\n  const firstNameKey = user.firstName !== undefined ? \"firstName\" : user.name !== undefined ? \"name\" : \"firstName\"\r\n  const lastNameKey =\r\n    user.lastName !== undefined ? \"lastName\" : user.last !== undefined ? \"last\" : user.familyName !== undefined ? \"familyName\" : \"lastName\"\r\n  const emailKey = user.email !== undefined ? \"email\" : \"email\"\r\n\r\n  return (\r\n    <Box sx={{ p: 3 }}>\r\n      <Paper sx={{ p: 3 }}>\r\n        <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"space-between\" sx={{ mb: 2 }}>\r\n          <Box>\r\n            <Typography variant=\"h6\">Manage user</Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\">\r\n              ID: {user._id ?? user.id ?? \"(unknown)\"}\r\n            </Typography>\r\n          </Box>\r\n\r\n          <Stack direction=\"row\" spacing={1}>\r\n            <Button variant=\"outlined\" onClick={() => router.push(\"/table\")}>\r\n              Back\r\n            </Button>\r\n            <Button color=\"error\" variant=\"contained\" onClick={openConfirm} disabled={deleting}>\r\n              {deleting ? \"Deleting…\" : \"Delete\"}\r\n            </Button>\r\n          </Stack>\r\n        </Stack>\r\n\r\n        <Divider sx={{ mb: 2 }} />\r\n\r\n        <Box component=\"form\" onSubmit={handleSave}>\r\n          <Stack spacing={2}>\r\n            <TextField\r\n              label=\"First name\"\r\n              name={firstNameKey}\r\n              value={user[firstNameKey] ?? \"\"}\r\n              onChange={handleChange}\r\n              fullWidth\r\n            />\r\n\r\n            <TextField label=\"Last name\" name={lastNameKey} value={user[lastNameKey] ?? \"\"} onChange={handleChange} fullWidth />\r\n\r\n            <TextField label=\"Email\" name={emailKey} value={user[emailKey] ?? \"\"} onChange={handleChange} fullWidth />\r\n\r\n            <Stack direction={{ xs: \"column\", sm: \"row\" }} spacing={2}>\r\n              <TextField\r\n                label=\"Gender\"\r\n                name=\"gender\"\r\n                value={user.gender ?? \"\"}\r\n                onChange={handleChange}\r\n                fullWidth\r\n                placeholder=\"e.g. male / female / other\"\r\n              />\r\n\r\n              <TextField label=\"Country\" name=\"country\" value={user.country ?? \"\"} onChange={handleChange} fullWidth />\r\n            </Stack>\r\n\r\n            {/* Optional: show raw JSON for fields that are not displayed above */}\r\n            <TextField\r\n              label=\"Raw JSON (for advanced edits)\"\r\n              value={JSON.stringify(user, null, 2)}\r\n              multiline\r\n              minRows={6}\r\n              onChange={(e) => {\r\n                // attempt to parse JSON to update state; if invalid, just keep raw text until save\r\n                try {\r\n                  const parsed = JSON.parse(e.target.value)\r\n                  setUser(parsed)\r\n                } catch {\r\n                  // ignore parse errors and keep the user's text in a non-destructive way\r\n                }\r\n              }}\r\n              fullWidth\r\n            />\r\n\r\n            {error && (\r\n              <Typography color=\"error\" variant=\"body2\">\r\n                {error}\r\n              </Typography>\r\n            )}\r\n\r\n            <Stack direction=\"row\" spacing={1} justifyContent=\"flex-end\">\r\n              <Button variant=\"outlined\" onClick={() => router.push(\"/table\")} disabled={saving}>\r\n                Cancel\r\n              </Button>\r\n              <Button type=\"submit\" variant=\"contained\" disabled={saving}>\r\n                {saving ? \"Saving…\" : \"Save changes\"}\r\n              </Button>\r\n            </Stack>\r\n          </Stack>\r\n        </Box>\r\n      </Paper>\r\n\r\n      <Dialog open={confirmOpen} onClose={closeConfirm}>\r\n        <DialogTitle>Delete user?</DialogTitle>\r\n        <DialogContent>\r\n          <Typography>Are you sure you want to permanently delete this user? This action cannot be undone.</Typography>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={closeConfirm}>Cancel</Button>\r\n          <Button\r\n            color=\"error\"\r\n            variant=\"contained\"\r\n            onClick={() => {\r\n              handleDelete()\r\n            }}\r\n            disabled={deleting}\r\n          >\r\n            {deleting ? \"Deleting…\" : \"Delete\"}\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </Box>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}