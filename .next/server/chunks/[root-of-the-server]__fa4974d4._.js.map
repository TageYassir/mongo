{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///D:/Saas_MongoDB/mongo/app/api/users/online/route.js"],"sourcesContent":["import { MongoClient, ObjectId } from \"mongodb\"\r\n\r\nconst uri = process.env.MONGODB_URI\r\nconst dbName = process.env.MONGODB_DB || undefined\r\n\r\nexport async function PATCH(req) {\r\n  if (!uri) {\r\n    return new Response(JSON.stringify({ error: \"MONGODB_URI not configured\" }), { status: 500 })\r\n  }\r\n\r\n  let body\r\n  try {\r\n    body = await req.json()\r\n  } catch (e) {\r\n    return new Response(JSON.stringify({ error: \"Invalid JSON\" }), { status: 400 })\r\n  }\r\n\r\n  const { id, email, online } = body\r\n  if (!id && !email) {\r\n    return new Response(JSON.stringify({ error: \"Provide id or email\" }), { status: 400 })\r\n  }\r\n\r\n  const client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true })\r\n  try {\r\n    await client.connect()\r\n    const db = dbName ? client.db(dbName) : client.db()\r\n    const users = db.collection(\"users\")\r\n\r\n    const filter = id ? { _id: new ObjectId(id) } : { email }\r\n    const update = {\r\n      $set: {\r\n        online: Boolean(online),\r\n        lastOnlineAt: new Date(),\r\n      },\r\n    }\r\n\r\n    const result = await users.updateOne(filter, update, { upsert: false })\r\n\r\n    if (result.matchedCount === 0) {\r\n      return new Response(JSON.stringify({ matched: 0 }), { status: 404 })\r\n    }\r\n\r\n    return new Response(JSON.stringify({ ok: true }), { status: 200 })\r\n  } catch (e) {\r\n    console.error(\"DB update error:\", e)\r\n    return new Response(JSON.stringify({ error: \"Database update failed\" }), { status: 500 })\r\n  } finally {\r\n    await client.close()\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;AAElC,eAAe,MAAM,GAAG;IAC7B,IAAI,CAAC,KAAK;QACR,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAA6B,IAAI;YAAE,QAAQ;QAAI;IAC7F;IAEA,IAAI;IACJ,IAAI;QACF,OAAO,MAAM,IAAI,IAAI;IACvB,EAAE,OAAO,GAAG;QACV,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAe,IAAI;YAAE,QAAQ;QAAI;IAC/E;IAEA,MAAM,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;IAC9B,IAAI,CAAC,MAAM,CAAC,OAAO;QACjB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAsB,IAAI;YAAE,QAAQ;QAAI;IACtF;IAEA,MAAM,SAAS,IAAI,sHAAW,CAAC,KAAK;QAAE,iBAAiB;QAAM,oBAAoB;IAAK;IACtF,IAAI;QACF,MAAM,OAAO,OAAO;QACpB,MAAM,KAAK,SAAS,OAAO,EAAE,CAAC,UAAU,OAAO,EAAE;QACjD,MAAM,QAAQ,GAAG,UAAU,CAAC;QAE5B,MAAM,SAAS,KAAK;YAAE,KAAK,IAAI,mHAAQ,CAAC;QAAI,IAAI;YAAE;QAAM;QACxD,MAAM,SAAS;YACb,MAAM;gBACJ,QAAQ,QAAQ;gBAChB,cAAc,IAAI;YACpB;QACF;QAEA,MAAM,SAAS,MAAM,MAAM,SAAS,CAAC,QAAQ,QAAQ;YAAE,QAAQ;QAAM;QAErE,IAAI,OAAO,YAAY,KAAK,GAAG;YAC7B,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,SAAS;YAAE,IAAI;gBAAE,QAAQ;YAAI;QACpE;QAEA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,IAAI;QAAK,IAAI;YAAE,QAAQ;QAAI;IAClE,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAyB,IAAI;YAAE,QAAQ;QAAI;IACzF,SAAU;QACR,MAAM,OAAO,KAAK;IACpB;AACF","debugId":null}}]
}