(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/app/uis/chat/[id]/ChatClient.js [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>ChatClient
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$app$2d$dir$2f$link$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/client/app-dir/link.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/navigation.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/Box/Box.js [app-client] (ecmascript) <export default as Box>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Typography$2f$Typography$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Typography$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/Typography/Typography.js [app-client] (ecmascript) <export default as Typography>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Container$2f$Container$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Container$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/Container/Container.js [app-client] (ecmascript) <export default as Container>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$TextField$2f$TextField$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__TextField$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/TextField/TextField.js [app-client] (ecmascript) <export default as TextField>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Button$2f$Button$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Button$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/Button/Button.js [app-client] (ecmascript) <export default as Button>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$List$2f$List$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__List$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/List/List.js [app-client] (ecmascript) <export default as List>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$ListItem$2f$ListItem$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ListItem$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/ListItem/ListItem.js [app-client] (ecmascript) <export default as ListItem>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$IconButton$2f$IconButton$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__IconButton$3e$__ = __turbopack_context__.i("[project]/node_modules/@mui/material/esm/IconButton/IconButton.js [app-client] (ecmascript) <export default as IconButton>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$icons$2d$material$2f$esm$2f$Image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@mui/icons-material/esm/Image.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$icons$2d$material$2f$esm$2f$Mic$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@mui/icons-material/esm/Mic.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$icons$2d$material$2f$esm$2f$Stop$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@mui/icons-material/esm/Stop.js [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
'use client';
;
;
;
;
;
;
;
function ChatClient(param) {
    let { receiver: receiverFromServer = null, receiverId: receiverProp = null } = param;
    _s();
    const searchParams = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useSearchParams"])();
    const receiverFromQuery = searchParams ? searchParams.get("receiver") : null;
    const params = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useParams"] ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useParams"])() : {};
    var _params_id;
    const routeId = (_params_id = params === null || params === void 0 ? void 0 : params.id) !== null && _params_id !== void 0 ? _params_id : null;
    const receiverId = receiverFromServer ? receiverFromServer._id || receiverFromServer.id || null : receiverProp || receiverFromQuery || routeId || null;
    const [currentUserId, setCurrentUserId] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [currentUser, setCurrentUser] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [receiver, setReceiver] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(receiverFromServer || null);
    const [messages, setMessages] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])([]);
    const [text, setText] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("");
    const [sending, setSending] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [error, setError] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [loadingMessages, setLoadingMessages] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    // recording state
    const [recording, setRecording] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const mediaRecorderRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const recordedChunksRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])([]);
    const messagesEndRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    const fileInputRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useRef"])(null);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ChatClient.useEffect": ()=>{
            async function loadCurrentUser() {
                try {
                    const res = await fetch("/api/users?operation=get-current");
                    if (res.ok) {
                        var _payload_user, _payload_user1, _payload_current;
                        const payload = await res.json();
                        const uid = (payload === null || payload === void 0 ? void 0 : (_payload_user = payload.user) === null || _payload_user === void 0 ? void 0 : _payload_user._id) || (payload === null || payload === void 0 ? void 0 : (_payload_user1 = payload.user) === null || _payload_user1 === void 0 ? void 0 : _payload_user1.id) || (payload === null || payload === void 0 ? void 0 : (_payload_current = payload.current) === null || _payload_current === void 0 ? void 0 : _payload_current.id) || (payload === null || payload === void 0 ? void 0 : payload.id) || null;
                        if (uid) {
                            setCurrentUserId(uid);
                            try {
                                const r2 = await fetch("/api/users/".concat(encodeURIComponent(uid)));
                                if (r2.ok) {
                                    const p2 = await r2.json();
                                    var _p2_user;
                                    const usr = (_p2_user = p2 === null || p2 === void 0 ? void 0 : p2.user) !== null && _p2_user !== void 0 ? _p2_user : p2;
                                    setCurrentUser(usr || null);
                                    return;
                                }
                            } catch (e) {}
                            setCurrentUser((payload === null || payload === void 0 ? void 0 : payload.user) || null);
                            return;
                        }
                    }
                } catch (e) {
                // fallback to localStorage
                }
                try {
                    const raw = ("TURBOPACK compile-time truthy", 1) ? localStorage.getItem('user') : "TURBOPACK unreachable";
                    if (raw) {
                        const parsed = JSON.parse(raw);
                        if (parsed === null || parsed === void 0 ? void 0 : parsed.id) {
                            setCurrentUserId(parsed.id);
                            setCurrentUser(parsed);
                        }
                    }
                } catch (e) {}
            }
            loadCurrentUser();
        }
    }["ChatClient.useEffect"], []);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useEffect"])({
        "ChatClient.useEffect": ()=>{
            async function fetchConversation() {
                if (!receiverId) return;
                let userA = currentUserId;
                if (!userA) {
                    try {
                        const raw = ("TURBOPACK compile-time truthy", 1) ? localStorage.getItem("user") : "TURBOPACK unreachable";
                        if (raw) {
                            const parsed = JSON.parse(raw);
                            if (parsed === null || parsed === void 0 ? void 0 : parsed.id) userA = parsed.id;
                        }
                    } catch (e) {}
                }
                if (!userA) return;
                setLoadingMessages(true);
                setError(null);
                try {
                    const url = "/api/messages?operation=get-conversation&userA=".concat(encodeURIComponent(userA), "&userB=").concat(encodeURIComponent(receiverId));
                    const res = await fetch(url);
                    if (!res.ok) {
                        const payload = await res.json().catch({
                            "ChatClient.useEffect.fetchConversation": ()=>null
                        }["ChatClient.useEffect.fetchConversation"]);
                        setError((payload === null || payload === void 0 ? void 0 : payload.error) || "Server returned ".concat(res.status));
                        setMessages([]);
                    } else {
                        const payload = await res.json();
                        const msgs = Array.isArray(payload === null || payload === void 0 ? void 0 : payload.messages) ? payload.messages : [];
                        setMessages(msgs);
                        setTimeout({
                            "ChatClient.useEffect.fetchConversation": ()=>scrollToBottom()
                        }["ChatClient.useEffect.fetchConversation"], 50);
                    }
                } catch (err) {
                    setError(err.message || "Failed to load conversation");
                } finally{
                    setLoadingMessages(false);
                }
            }
            fetchConversation();
        // refetch when receiver or user changes
        }
    }["ChatClient.useEffect"], [
        currentUserId,
        receiverId
    ]);
    const scrollToBottom = ()=>{
        try {
            if (messagesEndRef.current) {
                messagesEndRef.current.scrollIntoView({
                    behavior: "smooth",
                    block: "end"
                });
            }
        } catch (e) {}
    };
    // upload helper: sends file via FormData to /api/messages/upload and returns { url, filename, size, type }
    async function uploadFile(file) {
        try {
            const fd = new FormData();
            fd.append("file", file);
            const res = await fetch("/api/messages/upload", {
                method: "POST",
                body: fd
            });
            if (!res.ok) {
                const body = await res.json().catch(()=>null);
                throw new Error((body === null || body === void 0 ? void 0 : body.error) || "Upload failed (".concat(res.status, ")"));
            }
            const payload = await res.json();
            return (payload === null || payload === void 0 ? void 0 : payload.file) || null;
        } catch (err) {
            console.error("uploadFile", err);
            throw err;
        }
    }
    async function handleSend() {
        if ((!text || text.trim() === "") && messages.length && !sending) {
        // do nothing if empty message
        }
        if (!receiverId) {
            setError("No receiver selected.");
            return;
        }
        setSending(true);
        setError(null);
        const sentAt = new Date().toISOString();
        let senderIdFinal = currentUserId;
        if (!senderIdFinal) {
            try {
                const raw = ("TURBOPACK compile-time truthy", 1) ? localStorage.getItem("user") : "TURBOPACK unreachable";
                if (raw) {
                    const parsed = JSON.parse(raw);
                    senderIdFinal = (parsed === null || parsed === void 0 ? void 0 : parsed.id) || null;
                }
            } catch (e) {}
        }
        if (!senderIdFinal) {
            setError("Unable to determine current user id. Please login again.");
            setSending(false);
            return;
        }
        const messagePayload = {
            senderId: senderIdFinal,
            receiverId,
            text: text.trim() || "",
            sentAt,
            attachments: []
        };
        try {
            const res = await fetch("/api/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(messagePayload)
            });
            if (res.ok) {
                const payload = await res.json();
                const saved = (payload === null || payload === void 0 ? void 0 : payload.message) || messagePayload;
                setMessages((m)=>[
                        ...m,
                        saved
                    ]);
                setText("");
                setTimeout(()=>scrollToBottom(), 50);
            // Optionally refetch conversation to ensure persisted ordering
            } else {
                const payload = await res.json().catch(()=>null);
                setError((payload === null || payload === void 0 ? void 0 : payload.error) || "Server returned ".concat(res.status));
            }
        } catch (err) {
            console.error("send message error", err);
            setError("Failed to send message");
        } finally{
            setSending(false);
        }
    }
    // handle image file selection
    async function handleImageSelected(file) {
        if (!file) return;
        try {
            const uploaded = await uploadFile(file);
            if (!(uploaded === null || uploaded === void 0 ? void 0 : uploaded.url)) throw new Error("Upload did not return url");
            // now send a message with attachment
            const senderIdFinal = currentUserId || JSON.parse(localStorage.getItem("user") || "{}").id;
            const payload = {
                senderId: senderIdFinal,
                receiverId,
                text: "",
                sentAt: new Date().toISOString(),
                attachments: [
                    {
                        type: "image",
                        url: uploaded.url,
                        filename: uploaded.filename,
                        size: uploaded.size
                    }
                ]
            };
            const r = await fetch("/api/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });
            if (r.ok) {
                const p = await r.json();
                setMessages((m)=>[
                        ...m,
                        (p === null || p === void 0 ? void 0 : p.message) || payload
                    ]);
                setTimeout(()=>scrollToBottom(), 50);
            } else {
                const p = await r.json().catch(()=>null);
                setError((p === null || p === void 0 ? void 0 : p.error) || "Server returned ".concat(r.status));
            }
        } catch (err) {
            console.error("image send error", err);
            setError(err.message || "Image upload failed");
        }
    }
    // Recording voice message
    async function startRecording() {
        setError(null);
        try {
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: true
            });
            const mediaRecorder = new MediaRecorder(stream);
            recordedChunksRef.current = [];
            mediaRecorder.addEventListener("dataavailable", (ev)=>{
                if (ev.data && ev.data.size > 0) recordedChunksRef.current.push(ev.data);
            });
            mediaRecorder.addEventListener("stop", async ()=>{
                try {
                    const blob = new Blob(recordedChunksRef.current, {
                        type: "audio/webm"
                    });
                    const file = new File([
                        blob
                    ], "voice-".concat(Date.now(), ".webm"), {
                        type: blob.type
                    });
                    await handleImageSelected(file); // reuse upload/send logic (name is generic)
                } catch (err) {
                    console.error("record stop error", err);
                } finally{
                    setRecording(false);
                    try {
                        stream.getTracks().forEach((t)=>t.stop());
                    } catch (e) {}
                }
            });
            mediaRecorderRef.current = mediaRecorder;
            mediaRecorder.start();
            setRecording(true);
        } catch (err) {
            console.error("startRecording error", err);
            setError("Could not start audio recording (permission denied or unsupported).");
            setRecording(false);
        }
    }
    function stopRecording() {
        try {
            if (mediaRecorderRef.current && mediaRecorderRef.current.state !== "inactive") {
                mediaRecorderRef.current.stop();
            }
        } catch (e) {}
    }
    // file input change handler
    function onFileInputChange(e) {
        const f = e.target.files && e.target.files[0];
        if (f) handleImageSelected(f);
        e.target.value = null;
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Container$2f$Container$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Container$3e$__["Container"], {
        maxWidth: "md",
        sx: {
            display: "flex",
            flexDirection: "column",
            height: "80vh",
            p: 0
        },
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__["Box"], {
                sx: {
                    p: 2,
                    borderBottom: "1px solid #eee"
                },
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Typography$2f$Typography$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Typography$3e$__["Typography"], {
                        variant: "h6",
                        children: "Chat"
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 292,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Typography$2f$Typography$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Typography$3e$__["Typography"], {
                        variant: "body2",
                        color: "text.secondary",
                        children: receiver ? receiver.pseudo || receiver.firstName : "Select a user"
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 293,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                lineNumber: 291,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__["Box"], {
                sx: {
                    flex: 1,
                    overflowY: "auto",
                    p: 2,
                    bgcolor: "#fafafa"
                },
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$List$2f$List$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__List$3e$__["List"], {
                        children: messages.map((m, idx)=>{
                            const isMe = String(m.senderId) === String(currentUserId);
                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$ListItem$2f$ListItem$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__ListItem$3e$__["ListItem"], {
                                sx: {
                                    display: "flex",
                                    flexDirection: "column",
                                    alignItems: isMe ? "flex-end" : "flex-start"
                                },
                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__["Box"], {
                                    sx: {
                                        bgcolor: isMe ? "#d1ffd6" : "#fff",
                                        p: 1,
                                        borderRadius: 1,
                                        maxWidth: "80%"
                                    },
                                    children: [
                                        m.text ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Typography$2f$Typography$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Typography$3e$__["Typography"], {
                                            variant: "body1",
                                            children: m.text
                                        }, void 0, false, {
                                            fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                            lineNumber: 304,
                                            columnNumber: 29
                                        }, this) : null,
                                        Array.isArray(m.attachments) && m.attachments.map((a, i)=>{
                                            if (a.type === "image") {
                                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__["Box"], {
                                                    sx: {
                                                        mt: 1
                                                    },
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("img", {
                                                        src: a.url,
                                                        alt: a.filename || "image",
                                                        style: {
                                                            maxWidth: "240px",
                                                            borderRadius: 6
                                                        }
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                                        lineNumber: 308,
                                                        columnNumber: 58
                                                    }, this)
                                                }, i, false, {
                                                    fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                                    lineNumber: 308,
                                                    columnNumber: 30
                                                }, this);
                                            }
                                            if (a.type === "audio") {
                                                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__["Box"], {
                                                    sx: {
                                                        mt: 1
                                                    },
                                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("audio", {
                                                        controls: true,
                                                        src: a.url
                                                    }, void 0, false, {
                                                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                                        lineNumber: 311,
                                                        columnNumber: 58
                                                    }, this)
                                                }, i, false, {
                                                    fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                                    lineNumber: 311,
                                                    columnNumber: 30
                                                }, this);
                                            }
                                            // fallback: show link
                                            return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__["Box"], {
                                                sx: {
                                                    mt: 1
                                                },
                                                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("a", {
                                                    href: a.url,
                                                    target: "_blank",
                                                    rel: "noreferrer",
                                                    children: a.filename || a.url
                                                }, void 0, false, {
                                                    fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                                    lineNumber: 314,
                                                    columnNumber: 56
                                                }, this)
                                            }, i, false, {
                                                fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                                lineNumber: 314,
                                                columnNumber: 28
                                            }, this);
                                        }),
                                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Typography$2f$Typography$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Typography$3e$__["Typography"], {
                                            variant: "caption",
                                            color: "text.secondary",
                                            sx: {
                                                display: "block",
                                                mt: 0.5
                                            },
                                            children: m.sentAt ? new Date(m.sentAt).toLocaleString() : ""
                                        }, void 0, false, {
                                            fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                            lineNumber: 316,
                                            columnNumber: 19
                                        }, this)
                                    ]
                                }, void 0, true, {
                                    fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                    lineNumber: 303,
                                    columnNumber: 17
                                }, this)
                            }, m._id || m.id || idx, false, {
                                fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                                lineNumber: 302,
                                columnNumber: 15
                            }, this);
                        })
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 298,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        ref: messagesEndRef
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 324,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                lineNumber: 297,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Box$2f$Box$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Box$3e$__["Box"], {
                sx: {
                    borderTop: "1px solid #eee",
                    p: 1,
                    display: "flex",
                    gap: 1,
                    alignItems: "center"
                },
                children: [
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("input", {
                        type: "file",
                        accept: "image/*,audio/*",
                        ref: fileInputRef,
                        style: {
                            display: "none"
                        },
                        onChange: onFileInputChange
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 329,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$IconButton$2f$IconButton$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__IconButton$3e$__["IconButton"], {
                        onClick: ()=>fileInputRef.current && fileInputRef.current.click(),
                        title: "Attach photo or audio",
                        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$icons$2d$material$2f$esm$2f$Image$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {}, void 0, false, {
                            fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                            lineNumber: 331,
                            columnNumber: 11
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 330,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$IconButton$2f$IconButton$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__IconButton$3e$__["IconButton"], {
                        onClick: ()=>{
                            recording ? stopRecording() : startRecording();
                        },
                        color: recording ? "error" : "default",
                        title: recording ? "Stop recording" : "Record voice",
                        children: recording ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$icons$2d$material$2f$esm$2f$Stop$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {}, void 0, false, {
                            fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                            lineNumber: 335,
                            columnNumber: 24
                        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$icons$2d$material$2f$esm$2f$Mic$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["default"], {}, void 0, false, {
                            fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                            lineNumber: 335,
                            columnNumber: 39
                        }, this)
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 334,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$TextField$2f$TextField$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__TextField$3e$__["TextField"], {
                        placeholder: "Type a message...",
                        value: text,
                        onChange: (e)=>setText(e.target.value),
                        fullWidth: true,
                        size: "small",
                        onKeyDown: (e)=>{
                            if (e.key === "Enter" && !e.shiftKey) {
                                e.preventDefault();
                                handleSend();
                            }
                        }
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 338,
                        columnNumber: 9
                    }, this),
                    /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$mui$2f$material$2f$esm$2f$Button$2f$Button$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$export__default__as__Button$3e$__["Button"], {
                        variant: "contained",
                        onClick: handleSend,
                        disabled: sending,
                        children: "Send"
                    }, void 0, false, {
                        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                        lineNumber: 347,
                        columnNumber: 9
                    }, this)
                ]
            }, void 0, true, {
                fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
                lineNumber: 328,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/app/uis/chat/[id]/ChatClient.js",
        lineNumber: 290,
        columnNumber: 5
    }, this);
}
_s(ChatClient, "g1NNGhb7A5/1sj2vkP4N63eHIoU=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useSearchParams"],
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$navigation$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useParams"]
    ];
});
_c = ChatClient;
var _c;
__turbopack_context__.k.register(_c, "ChatClient");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(__turbopack_context__.m, globalThis.$RefreshHelpers$);
}
}),
]);

//# sourceMappingURL=app_uis_chat_%5Bid%5D_ChatClient_bb434679.js.map