{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Saas_MongoDB/mongo/app/uis/user-space/layout.js"],"sourcesContent":["'use client';\n\nimport React, { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\n\n/**\n * User-space layout\n *\n * Responsibilities:\n * - Provide a signOut() helper that:\n *   - calls common server logout endpoints (best-effort)\n *   - clears the userId cookie and localStorage userId\n *   - removes any local wallet and transaction keys (wallet:<userId>:* and tx:*)\n *   - broadcasts a 'user-logout-ts' localStorage key so other tabs / client components detect sign-out\n * - Listens for incoming logout broadcasts and ensures local wallet state is cleared in this tab as well.\n *\n * Usage:\n * - This component renders children and a Sign out button. It also exposes window.appSignOut() so existing logout\n *   buttons can call the same cleanup without changes.\n */\n\nexport default function UserSpaceLayout({ children }) {\n  const router = useRouter();\n\n  const hasWindow = typeof window !== 'undefined';\n  const hasDocument = typeof document !== 'undefined';\n\n  function clearWalletLocalKeysForUser(optionalUserId) {\n    if (!hasWindow) return;\n    try {\n      for (let i = localStorage.length - 1; i >= 0; i--) {\n        const key = localStorage.key(i);\n        if (!key) continue;\n        if (optionalUserId) {\n          if (key.startsWith(`wallet:${optionalUserId}:`) || key.startsWith(`tx:${optionalUserId}`) || key.startsWith(`tx:`)) {\n            localStorage.removeItem(key);\n          }\n        } else {\n          if (key.startsWith('wallet:') || key.startsWith('tx:')) {\n            localStorage.removeItem(key);\n          }\n        }\n      }\n    } catch (e) {\n      // ignore storage errors\n    }\n  }\n\n  function clearUserIdCookie() {\n    if (!hasDocument) return;\n    try {\n      document.cookie = 'userId=; path=/; max-age=0';\n    } catch (e) {}\n  }\n\n  async function signOut() {\n    // best-effort server logout\n    try {\n      await fetch('/api/users?operation=logout', { method: 'POST', credentials: 'include' }).catch(() => {});\n      await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' }).catch(() => {});\n    } catch (e) {\n      // ignore\n    }\n\n    // clear client-side markers\n    clearUserIdCookie();\n    try { localStorage.removeItem('userId'); } catch (e) {}\n\n    // clear wallet & tx local keys\n    clearWalletLocalKeysForUser();\n\n    // broadcast logout to other tabs/components\n    try {\n      localStorage.setItem('user-logout-ts', String(Date.now()));\n    } catch (e) {}\n\n    // navigate to homepage or login page\n    try {\n      router.replace('/');\n    } catch (e) {}\n  }\n\n  useEffect(() => {\n    if (!hasWindow) return;\n\n    // Expose global helper for existing logout buttons or scripts\n    try {\n      window.appSignOut = signOut;\n    } catch (e) {}\n\n    function onStorage(e) {\n      try {\n        if (!e) return;\n        // Another tab broadcasted logout\n        if (e.key === 'user-logout-ts') {\n          clearUserIdCookie();\n          try { localStorage.removeItem('userId'); } catch (er) {}\n          clearWalletLocalKeysForUser();\n          // Optionally navigate away:\n          // router.replace('/');\n        }\n\n        // If userId was removed explicitly in another tab, clear wallet keys too\n        if (e.key === 'userId' && (e.newValue === null || e.newValue === '')) {\n          clearWalletLocalKeysForUser();\n        }\n      } catch (err) {\n        // ignore\n      }\n    }\n\n    window.addEventListener('storage', onStorage);\n    return () => {\n      try { delete window.appSignOut; } catch (e) {}\n      window.removeEventListener('storage', onStorage);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div style={{ minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>\n      <div style={{ background: '#fafafa', borderBottom: '1px solid #eee', padding: 12, display: 'flex', alignItems: 'center', gap: 12 }}>\n        <div style={{ fontWeight: 700 }}>User space</div>\n        <div style={{ flex: 1 }} />\n        <button\n          onClick={signOut}\n          style={{\n            padding: '8px 12px',\n            borderRadius: 6,\n            border: '1px solid #ddd',\n            background: '#fff',\n            cursor: 'pointer',\n            fontSize: 14\n          }}\n        >\n          Sign out\n        </button>\n      </div>\n\n      <main style={{ flex: 1 }}>\n        {children}\n      </main>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///D:/Saas_MongoDB/mongo/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}