{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Saas_MongoDB/mongo/app/uis/reset-password/page.js"],"sourcesContent":["\"use client\"\n\nimport { useState } from \"react\"\nimport { useSearchParams, useRouter } from \"next/navigation\"\nimport { Container, Stack, TextField, Button, Typography, InputAdornment, IconButton } from \"@mui/material\"\nimport Visibility from '@mui/icons-material/Visibility'\nimport VisibilityOff from '@mui/icons-material/VisibilityOff'\n\nexport default function ResetPasswordPage() {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n\n  // Récupère l'email depuis l'URL si présent\n  const emailFromQuery = searchParams.get(\"email\") || \"\"\n  const [email, setEmail] = useState(emailFromQuery)\n  const [code, setCode] = useState(\"\")\n  const [newPassword, setNewPassword] = useState(\"\")\n  const [error, setError] = useState(\"\")\n  const [success, setSuccess] = useState(\"\")\n\n  // Add show/hide password state and handlers\n  const [showPassword, setShowPassword] = useState(false)\n  const toggleShowPassword = () => setShowPassword((s) => !s)\n  const handleMouseDownPassword = (e) => e.preventDefault()\n\n  function isStrongPassword(pwd) {\n  if (!pwd || typeof pwd !== 'string') return false\n  const trimmed = pwd\n  if (trimmed.length < 8) return false\n  const hasUpper = /[A-Z]/.test(trimmed)\n  const hasLower = /[a-z]/.test(trimmed)\n  const hasDigit = /[0-9]/.test(trimmed)\n  const hasSpecial = /[^A-Za-z0-9]/.test(trimmed)\n  return hasUpper && hasLower && hasDigit && hasSpecial\n}\n\n  const handleReset = async () => {\n    setError(\"\")\n    setSuccess(\"\")\n\n    if (!isStrongPassword(newPassword)) {\n      setError('Password must be ≥8 chars with upper, lower, digit and special character.')\n      return\n    }\n    else if (!email || !code || !newPassword) {\n      setError(\"Please fill in all fields.\")\n      return\n    }\n\n    try {\n      const response = await fetch(\"/api/users?operation=reset-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, code, newPassword })\n      })\n\n      const data = await response.json()\n\n      if (data.error) {\n        setError(data.error)\n        return\n      }\n\n      setSuccess(\"Password reset successfully! You can now log in.\")\n      // Redirection vers login après 2 secondes\n      setTimeout(() => router.push(\"/uis\"), 2000)\n\n    } catch (err) {\n      console.error(err)\n      setError(\"An unexpected error occurred.\")\n    }\n  }\n\n  return (\n    <Container maxWidth=\"sm\">\n      <Stack direction=\"column\" spacing={2} mt={5}>\n        <Typography variant=\"h5\" textAlign=\"center\">Reset Your Password</Typography>\n        \n        <TextField \n          label=\"Email\"\n          type=\"email\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n        />\n\n        <TextField \n          label=\"Recovery Code\"\n          value={code}\n          onChange={(e) => setCode(e.target.value)}\n        />\n\n        <TextField \n          label=\"New Password\"\n          type={showPassword ? \"text\" : \"password\"}\n          value={newPassword}\n          onChange={(e) => setNewPassword(e.target.value)}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment position=\"end\">\n                <IconButton\n                  onClick={toggleShowPassword}\n                  onMouseDown={handleMouseDownPassword}\n                  edge=\"end\"\n                  aria-label={showPassword ? \"Hide password\" : \"Show password\"}\n                >\n                  {showPassword ? <VisibilityOff /> : <Visibility />}\n                </IconButton>\n              </InputAdornment>\n            )\n          }}\n        />\n\n        {error && <Typography color=\"error\">{error}</Typography>}\n        {success && <Typography color=\"success.main\">{success}</Typography>}\n\n        <Button variant=\"contained\" size=\"large\" onClick={handleReset}>\n          Reset Password\n        </Button>\n      </Stack>\n    </Container>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}